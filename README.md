# subscription-aggregation-service

Сервис для агрегации данных об онлайн-подписках пользователей.

---

## Оглавление

- [Описание](#описание)
- [Запуск](#запуск)
- [Логирование](#логирование)
- [Документация](#документация)
- [Дополнительно](#дополнительно)
- [Технологии](#технологии)

---

## Описание

Сервис предоставляет HTTP-ручки для CRUDL-операций над записями о подписках. Каждая запись
содержит:
1. Название сервиса, предоставляющего подписку
2. Стоимость месячной подписки в рублях
3. ID пользователя в формате UUID
4. Дата начала подписки (месяц и год)
5. Опционально дата окончания подписки

А также HTTP-ручку для подсчета суммарной стоимости всех подписок за выбранный период с фильтрацией по id пользователя и названию подписки. 

Если дата окончания не указана, считаем что подписка активна по настоящее время.

---

## Запуск

Для запуска проекта необходимо создать в корне проекта .env файл и заполнить его переменными (шаблон и дефолтные значения уже есть в файле .env.local, можно просто скопировать и всатвить в .env) 

Затем, если у вас установлена утилита make, необходимо выполнить:

```bash
make docker-up
```

Или, если её нет, выполнить команду:
```bash
docker-compose -f docker-compose.yml up -d
```

Другие команды для удобной работы с проектом можно посмотреть в Makefile (в корне проекта). 

---

## Логирование

У сервиса подключено логирование, режим которого можно изменять, меняя значение переменной SERVER_LOGGING (dev/prod) в .env файле.

Логи записываютя как консоль, так и в файл путь которому можно указать в пееременной SERVER_LOG_FILE_PATH (по умолчанию: logs/app.log) в .env файле.

---

## Документация
Swagger UI доступен по адресу после запуска приложения с дефолтным адресом:  
[http://localhost:8080/api/v1/doc/index.html](http://localhost:8080/api/v1/doc/index.html)  

В документации описаны все эндпоинты, возможные ошибки и примеры запросов.

---

## Дополнительно

- У сервера реализован паттерн Graceful Shutdown
- Логи записываются и в консоль и в файл
- Автоматическая миграция базы данных
- Добавлены unit-тесты на уровне контроллеров и модели

---

## Технологии

- Go 1.23.0
- Chi - маршрутизатор для создания HTTP-сервиса
- PostgreSQL
- Swagger (swaggo)
- Docker + docker-compose
- Zap для логирования
- Godotenv для работы с .env
- Pgx для работы с PostgreSQL

---